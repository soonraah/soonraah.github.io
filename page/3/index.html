<!doctype html><html lang=ja dir=auto>
<head>
<meta name=generator content="Hugo 0.92.0"><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Froglog</title>
<meta name=description content="blog">
<meta name=author content="soonraah">
<link rel=canonical href=https://soonraah.github.io/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css integrity="sha256-7I2jZsovtkdTfMt6j2+ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as=style>
<link rel=icon href=https://soonraah.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://soonraah.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://soonraah.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://soonraah.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://soonraah.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<link rel=alternate type=application/rss+xml href=https://soonraah.github.io/index.xml>
<link rel=alternate type=application/json href=https://soonraah.github.io/index.json>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-73329599-2','auto'),ga('send','pageview'))</script><meta property="og:title" content="Froglog">
<meta property="og:description" content="blog">
<meta property="og:type" content="website">
<meta property="og:url" content="https://soonraah.github.io/"><meta property="og:image" content="https://soonraah.github.io/47"><meta property="og:site_name" content="Froglog">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://soonraah.github.io/47">
<meta name=twitter:title content="Froglog">
<meta name=twitter:description content="blog">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"Froglog","url":"https://soonraah.github.io","description":"blog","thumbnailUrl":"https://soonraah.github.io/favicon.ico","sameAs":["https://twitter.com/soonraah","https://github.com/soonraah"]}</script>
</head>
<body class=list id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://soonraah.github.io accesskey=h title="Home (Alt + H)">
<img src=https://soonraah.github.io/image/brand/favicon.png alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://soonraah.github.io/about/ title=About>
<span>About</span>
</a>
</li>
<li>
<a href=https://soonraah.github.io/posts/ title=Posts>
<span>Posts</span>
</a>
</li>
<li>
<a href=https://soonraah.github.io/archives/ title=Archives>
<span>Archives</span>
</a>
</li>
<li>
<a href=https://soonraah.github.io/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://soonraah.github.io/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-entry>
<figure class=entry-cover><img loading=lazy src=https://soonraah.github.io/image/logo/flink_squirrel_color_logo.png alt="Apache Flink">
</figure>
<header class=entry-header>
<h2>Apache Flink の Broadcast State Pattern を用いた stream data と static data の join
</h2>
</header>
<div class=entry-content>
<p>star schema における fact table と dimension table の join のようなことを Apache Flink におけるストリーム処理で行いたい。
stream data と static data の join ということになる。
ただし dimension table 側も更新されるため、完全な static というわけではない。
このポストでは Flink v1.11 を前提とした。
join の方法 今回は DataStream API でこれを実現することを考える。
Flink のドキュメントを読むと broadcast state pattern でできそうだ。
The Broadcast State Pattern やり方としては次のようになる。
static data のファイルを FileProcessingMode.PROCESS_CONTINUOUSLY で読み込み DataStream 化 1 を broadcast() stream data の DataStream と 2 を connect() static data を PROCESS_CONTINUOUSLY で読むのは変更を得るため。...</p>
</div>
<footer class=entry-footer><span title="2020-08-06 22:00:00 +0900 JST">8月 6, 2020</span>&nbsp;·&nbsp;soonraah</footer>
<a class=entry-link aria-label="post link to Apache Flink の Broadcast State Pattern を用いた stream data と static data の join" href=https://soonraah.github.io/posts/flink-join-by-broadcast-state-pattern/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>あまり大きな Pull Request を作ってほしくない
</h2>
</header>
<div class=entry-content>
<p>GitHub Flow ベースの開発においてはあまり大きな pull request を作ってほしくないという話。
なんというか今更わざわざ言わなくてもいいんだけど…
仕事で何度か大きな pull request が投げられているのを見てしまったので、それはあまりよくないよというのを自分でも指摘しやすくするためにまとめておく。
Reference 最初に参考資料を挙げておく。
100 Duck-Sized Pull Requests 「巨大プルリク1件vs細かいプルリク100件」問題を考える（翻訳） Optimal pull request size これらを読めば特に私から言うこともないのだが…
これらに書いてあるとおりだが補足しておく。
Pull Request を小分けにしたときのメリット module を適切に切り出すモチベーションが得られる 次のような話がある。
共通化という考え方はアンチパターンを生み出すだけ説 これを理由に module を分けるべきところが分けられず、いろんなことができてしまうベタッと大きな module が生まれるのを見た。
もちろんよく考えられていない共通化は駄目だが、上記ポストでは一方で
ただし共通化という名の下におこなわれるのは「同じロジックを持つコードをまとめる」行為であって、抽象化のようにそのコード単位の意味を捉える作業はその範疇にない。抽象化というのはロジックを意味単位ごとにひとくくりにしていく行為で、これがどういうことなのかは次以降で述べていく。– 共通化という考え方はアンチパターンを生み出すだけ説 - タオルケット体操 と述べており抽象化、つまりコードの意味を考慮した上で適切な単位でまとめておくことは否定していない。
pull request を小さく分けるという行為のためには module や機能を適度なまとまりで切り分けること、つまり抽象化を考えていくことが必要となる。
したがって何でもできてしまう大きな module が生まれるのを防ぐ方向に働く。
(もちろんここで駄目な共通化がなされてしまうこともあるだろう)
リリースまでの期間が短く済む 前述の参考資料においても pull request が大きいと
Developers would put off reviews until they had time/energy and the development process would come to a halt....</p>
</div>
<footer class=entry-footer><span title="2020-08-03 22:00:00 +0900 JST">8月 3, 2020</span>&nbsp;·&nbsp;soonraah</footer>
<a class=entry-link aria-label="post link to あまり大きな Pull Request を作ってほしくない" href=https://soonraah.github.io/posts/no-more-huge-pull-request/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>勉強会メモ: Spark Meetup Tokyo #3 Online
</h2>
</header>
<div class=entry-content>
<p>2020-07-31 にオンライン開催された Spark Meetup Tokyo #3 Online に参加した。
感想などメモしておく。
全体感 トピックとしては主に
Spark 3.0 Spark + AI Summit 2020 Spark 周辺要素 といったところだろうか。
最近のコミュニティの動向や関心を日本語で聞くことができてよかった。
運営 & スピーカーの皆様、ありがとうございます。
発表 発表資料は公開されたら追加していく。
SPARK+AI Summit 2020 イベント概要 スピーカー: @tokyodataguy さん
Summit は金融業界の参加者が増えているらしい Spark で最も使われている言語は Python とのことだったが、Databricks の notebook サービスの話だった プロダクションコードではまた違うのだろう Spark 3.0 の update をざっくりと Spark 周辺要素の話をざっくりと Koalas Delta Lake Redash MLflow Introducing Koalas 1.0 Introducing Koalas 1....</p>
</div>
<footer class=entry-footer><span title="2020-08-01 15:00:00 +0900 JST">8月 1, 2020</span>&nbsp;·&nbsp;soonraah</footer>
<a class=entry-link aria-label="post link to 勉強会メモ: Spark Meetup Tokyo #3 Online" href=https://soonraah.github.io/posts/spark-meetup-tokyo-3/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>Spark DataFrame クエリの弱い分離レベル
</h2>
</header>
<div class=entry-content>
<p>Spark バッチ処理の問題を調べていたら分離レベルという概念にたどりついた。
分離レベルについて調べたので、Spark の問題の内容と絡めて記しておく。
考えてみれば当たり前でたいした話ではない。
分離レベルとは トランザクションの挙動についての暗黙の理解 アドホックな分析クエリやプロダクションコード中のクエリを書くとき、その単一のクエリのトランザクションにおいて「同時に実行されている別のクエリの commit 前の状態や commit 結果に影響され、このクエリの結果がおかしくなるかもしれない」ということは通常考えない。
トランザクションはデータベースのある時点の状態に対して正しく処理される、というほぼ無意識の理解をおそらくほとんどの開発者が持っている。
多くの場合この理解は間違っていない。
それはなぜかというと DB 等のデータ処理フレームワークがある強さの分離レベルを提供しているからである。
いろいろな分離レベル ACID 特性のうちの1つ、分離性 (Isolation) の程度を表すのが分離レベル。
トランザクション中に行われる操作の過程が他の操作から隠蔽されることを指し、日本語では分離性、独立性または隔離性ともいう。より形式的には、独立性とはトランザクション履歴が直列化されていることと言える。この性質と性能はトレードオフの関係にあるため、一般的にはこの性質の一部を緩和して実装される場合が多い。 – Wikipedia ACID (コンピュータ科学) 分離レベルには名前のついたものがいくつかあり、分離性の保証の強さが異なる。
具体的にはトランザクションの並行性の問題への対応力が異なる。
名著「データ指向アプリケーションデザイン」の第7章で分離レベルについて詳しく述べられているので、以下ではそちらからの引用。
分離レベルを弱い順に並べる。
read uncommitted
このレベルではダーティライトは生じませんが、ダーティリードは妨げられません。
read committed
データベースからの読み取りを行った際に見えるデータは、コミットされたもののみであること（ダーティリードは生じない）。 データベースへの書き込みを行う場合、上書きするのはコミットされたデータのみであること（ダーティライトは生じない）。 snapshot isolation
スナップショット分離の考え方は、それぞれのトランザクションがデータベースの一貫性のあるスナップショットから読み取りを行うというものです。すなわち、トランザクションが読み取るデータは、すべてそのトランザクションの開始時点のデータベースにコミット済みのものだけということです。
serializability
この分離レベルはトランザクションが並行して実行されていても、最終的な答えはそれぞれが1つずつ順番に、並行ではなく実行された場合と同じになることを保証します。
日本語で「分離レベル」を検索すると snapshot isolation の代わりに repeatable read が出てくる事が多い。...</p>
</div>
<footer class=entry-footer><span title="2020-07-19 22:00:00 +0900 JST">7月 19, 2020</span>&nbsp;·&nbsp;soonraah</footer>
<a class=entry-link aria-label="post link to Spark DataFrame クエリの弱い分離レベル" href=https://soonraah.github.io/posts/weak_isolation_level_of_dataframe/></a>
</article>
<article class=post-entry>
<figure class=entry-cover><img loading=lazy src=https://soonraah.github.io/image/logo/Apache_Spark_logo.svg alt="Apache Spark">
</figure>
<header class=entry-header>
<h2>Apache Spark 3.0.0 について調べた
</h2>
</header>
<div class=entry-content>
<p>はじめに Apache Spark 3.0.0 がリリースされました。
Spark Release 3.0.0 release note を見て個人的に気になったところなど簡単に調べました。
書いてみると Databricks の記事へのリンクばっかになってしまった…
全体感 こちらの記事を読めば全体感は OK.
Introducing Apache Spark 3.0 公式の release note には
Python is now the most widely used language on Spark.
とあってそうなん？ってなったけど、こちらの記事だと
Python is now the most widely used language on Spark and, consequently, was a key focus area of Spark 3.0 development. 68% of notebook commands on Databricks are in Python....</p>
</div>
<footer class=entry-footer><span title="2020-07-12 11:30:00 +0900 JST">7月 12, 2020</span>&nbsp;·&nbsp;soonraah</footer>
<a class=entry-link aria-label="post link to Apache Spark 3.0.0 について調べた" href=https://soonraah.github.io/posts/study-spark-3-0-0/></a>
</article>
<footer class=page-footer>
<nav class=pagination>
<a class=prev href=https://soonraah.github.io/page/2/>« 前のページ</a>
</nav>
</footer>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://soonraah.github.io>Froglog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>