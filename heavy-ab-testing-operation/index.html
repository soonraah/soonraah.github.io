<!doctype html>
<html lang="jp">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name="hugo-theme" content="Axiom 0.7.0">



  <link rel="icon" type="image/png" sizes="32x32" href="/image/brand/favicon.png">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/">
  <link rel="canonical" href="https://soonraah.github.io/heavy-ab-testing-operation/">
<link rel="preload" as="style" href="/bundle.css?v=1604718041" media="all">
<link rel="stylesheet" href="/bundle.css?v=1604718041" media="all">
<style>.cdata pre{color:#edf2f7;background-color:#2d3748}.cdata :not(pre)>code{color:#805ad5;background-color:#f7fafc}.chroma .err{color:#fed7d7;background-color:#9b2c2c}.chroma .hl{background-color:#4a5568}.chroma .ln{color:#a0aec0}.chroma .k,.chroma .kc,.chroma .kd,.chroma .kn,.chroma .kp,.chroma .kr{color:#63b3ed}.chroma .kt{color:#b794f4}.chroma .na{color:#f6e05e}.chroma .nb{color:#f6ad55}.chroma .nc{color:#fc8181}.chroma .no{color:#68d391}.chroma .nd{color:#fc8181}.chroma .ne{color:#fc8181}.chroma .nf{color:#f6ad55}.chroma .nt{color:#fc8181}.chroma .l{color:#b794f4}.chroma .dl,.chroma .ld,.chroma .s,.chroma .s2,.chroma .sa,.chroma .sb,.chroma .sc,.chroma .sd{color:#68d391}.chroma .se{color:#a0aec0}.chroma .s1,.chroma .sh,.chroma .si,.chroma .sr,.chroma .ss,.chroma .sx{color:#68d391}.chroma .il,.chroma .m,.chroma .mb,.chroma .mf,.chroma .mh,.chroma .mi,.chroma .mo{color:#b794f4}.chroma .o,.chroma .ow{color:#90cdf4}.chroma .p{color:#cbd5e0}.chroma .c,.chroma .c1,.chroma .ch,.chroma .cm,.chroma .cp,.chroma .cpf,.chroma .cs{color:#a0aec0}.chroma .ge{font-style:italic}.chroma .gs{font-weight:700}</style>



<title>A/B テストの運用が重くてつらいという話 : Froglog</title>

<meta property="og:title" content="A/B テストの運用が重くてつらいという話">
<meta property="og:site_name" content="Froglog">
<meta property="og:url" content="https://soonraah.github.io/heavy-ab-testing-operation/">
<link rel="image_src" href="https://soonraah.github.io/">
<meta property="og:image" content="https://soonraah.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<meta property="og:type" content="article">
<meta property="og:locale" content="jp">
<meta property="og:description" content="Photo by Jason Dent on Unsplash   前提 ここでは web システムで使われている機械学習のモデルやアルゴリズムを改善するための online の A/B テストを考える。 具体的に述べると web 広告における CTR 予測や EC サイトのレコメンデーション等が対象である。 よくあるやつ。 web システムにおいて online の A/B テストは KPI 改善の根幹でありとても重要だ。 それが重くなるとつらい、という話。 ここで「重い」と言っているのは計算資源のことではなく、A/B テストを実施する担当者の運用コストについて。 A/B テストの運用が重い場合のデメリット デメリット 1. KPI 改善が遅くなる デメリットと言えばこれが一番大きい。">
<meta name="description" content="Photo by Jason Dent on Unsplash   前提 ここでは web システムで使われている機械学習のモデルやアルゴリズムを改善するための online の A/B テストを考える。 具体的に述べると web 広告における CTR 予測や EC サイトのレコメンデーション等が対象である。 よくあるやつ。 web システムにおいて online の A/B テストは KPI 改善の根幹でありとても重要だ。 それが重くなるとつらい、という話。 ここで「重い」と言っているのは計算資源のことではなく、A/B テストを実施する担当者の運用コストについて。 A/B テストの運用が重い場合のデメリット デメリット 1. KPI 改善が遅くなる デメリットと言えばこれが一番大きい。">
<meta property="og:updated_time" content="2020-08-23T03:30:00Z">
<meta property="fb:app_id" content="">
<meta name="author" content="soonraah">
<meta property="article:author" content="https://soonraah.github.io/">
<meta property="article:published_time" content="2020-08-23T03:30:00Z">
<meta property="article:modified_time" content="2020-08-23T03:30:00Z">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "A/B テストの運用が重くてつらいという話",
  "alternativeHeadline": "Photo by Jason Dent on Unsplash   前提 ここでは web システムで使われている機械学習のモデルやアルゴリズムを改善するための online の A/B テストを考える。 具体的に述べると web 広告における CTR 予測や EC サイトのレコメンデーション等が対象である。 よくあるやつ。 web システムにおいて online の A/B テストは KPI 改善の根幹でありとても重要だ。 それが重くなるとつらい、という話。 ここで「重い」と言っているのは計算資源のことではなく、A/B テストを実施する担当者の運用コストについて。 A/B テストの運用が重い場合のデメリット デメリット 1. KPI 改善が遅くなる デメリットと言えばこれが一番大きい。",
  "url": "https://soonraah.github.io/heavy-ab-testing-operation/",
  "image": "https://soonraah.github.io/",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://soonraah.github.io/heavy-ab-testing-operation/"
  },
  "description": "Photo by Jason Dent on Unsplash   前提 ここでは web システムで使われている機械学習のモデルやアルゴリズムを改善するための online の A/B テストを考える。 具体的に述べると web 広告における CTR 予測や EC サイトのレコメンデーション等が対象である。 よくあるやつ。 web システムにおいて online の A/B テストは KPI 改善の根幹でありとても重要だ。 それが重くなるとつらい、という話。 ここで「重い」と言っているのは計算資源のことではなく、A/B テストを実施する担当者の運用コストについて。 A/B テストの運用が重い場合のデメリット デメリット 1. KPI 改善が遅くなる デメリットと言えばこれが一番大きい。",
  "author": {
    "@type": "Person",
    "name": "soonraah"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Froglog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://soonraah.github.io/"
    }
  },
  "datePublished": "2020-08-23T03:30:00Z",
  "dateModified": "2020-08-23T03:30:00Z",
  "articleBody": "\n\n\u003cfigure class=\"center\"\u003e\n\u003cimg\nclass=\"mb-2 mx-auto leading-none shadow-xl\"\nsrc=\"/image/photo/jason-dent-JVD3XPqjLaQ-unsplash.jpg\"\nalt=\"Photo by Jason Dent on\"\u003e\n\u003cfigcaption class=\"text-sm text-right text-raven-500\"\u003e\n\u003cp\u003ePhoto by Jason Dent on \u003ca href=\"https://unsplash.com/photos/JVD3XPqjLaQ\"\u003eUnsplash\u003c/a\u003e\u003c/p\u003e\n\u003c/figcaption\u003e\n\u003c/figure\u003e\n\n\u003ch2 id=\"前提\"\u003e前提\u003c/h2\u003e\n\u003cp\u003eここでは web システムで使われている機械学習のモデルやアルゴリズムを改善するための online の A/B テストを考える。\u003cbr\u003e\n具体的に述べると web 広告における CTR 予測や EC サイトのレコメンデーション等が対象である。\u003cbr\u003e\nよくあるやつ。\u003c/p\u003e\n\u003cp\u003eweb システムにおいて online の A/B テストは KPI 改善の根幹でありとても重要だ。\u003cbr\u003e\nそれが重くなるとつらい、という話。\u003cbr\u003e\nここで「重い」と言っているのは計算資源のことではなく、A/B テストを実施する担当者の運用コストについて。\u003c/p\u003e\n\u003ch2 id=\"ab-テストの運用が重い場合のデメリット\"\u003eA/B テストの運用が重い場合のデメリット\u003c/h2\u003e\n\u003ch3 id=\"デメリット-1-kpi-改善が遅くなる\"\u003eデメリット 1. KPI 改善が遅くなる\u003c/h3\u003e\n\u003cp\u003eデメリットと言えばこれが一番大きい。\u003cbr\u003e\n単純に A/B テストを1回まわすのに時間がかかってしまうし、それがゆえに online の A/B テストに入るまでの offline のテストが厚くなりここでも時間がかかってしまう。\u003cbr\u003e\nKPI 改善に時間がかかるというのはつまり売上や利益を大きくするのに時間がかかってしまうということである。\u003c/p\u003e\n\u003ch3 id=\"デメリット-2-kpi-改善における-offline-テストの比重が大きくなる\"\u003eデメリット 2. KPI 改善における offline テストの比重が大きくなる\u003c/h3\u003e\n\u003cp\u003e前述のとおりだが online の A/B テストが重いとそこで失敗できなくなり、結果としてその前段の offline のテストを厚くするということになる。\u003cbr\u003e\noffline のテストが厚いことの何が問題だろうか。\u003c/p\u003e\n\u003cp\u003eここで前提としている CTR 予測やレコメンデーションのようなタスクの場合、offline のデータは既存のモデルやアルゴリズムの影響を受けることになる。\u003cbr\u003e\n例えばレコメンデーションの場合を考えると、新しいモデルを offline で評価するための実験データの正例 (コンテンツの閲覧等) は既存モデルによって生み出される。\u003cbr\u003e\n既存モデルが「このコンテンツがいいよ」といってユーザに出したリスト、その中からコンテンツの閲覧が行われ正例となるからだ。\u003cbr\u003e\nこのような状況下での offline テストにおいては既存モデルと近い好みを持ったモデルのスコアが高くなる傾向がある。\u003c/p\u003e\n\u003cp\u003eもしかしたら既存モデルの影響を受けないようなデータをあえて用意しているような場合もあるかもしれないが、レアケースだろう。\u003cbr\u003e\n既存モデルの影響を受けないということは恩恵を受けないということなのでトレードオフでもある。\u003c/p\u003e\n\u003ch3 id=\"デメリット-3-新モデルアルゴリズムを却下しにくくなる\"\u003eデメリット 3. 新モデル／アルゴリズムを却下しにくくなる\u003c/h3\u003e\n\u003cp\u003eA/B テストの運用が重いと何度も繰り返すことができない。\u003cbr\u003e\nなので一発の A/B テストで既存モデル／アルゴリズムを置き換える成果を出さなければならないという圧が強くかかってしまう。\u003cbr\u003e\n既存モデル／アルゴリズムが勝って新しいものが負けてしまったときの埋没費用が大きいからだ。\u003c/p\u003e\n\u003cp\u003eそうなると次のような事が起こる。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e「新モデルをチューニングしてみよう！」\n\u003cul\u003e\n\u003cli\u003e数ヶ月前のデータでチューニングされていない既存モデル vs. 直近のデータでチューニングされた新モデル\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e「新モデルが KPI で勝っている間に意思決定しよう！」\n\u003cul\u003e\n\u003cli\u003e勝ったり負けたりする中で…\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eつまりフェアなテストではなくなってしまう。\u003c/p\u003e\n\u003ch2 id=\"なぜ-ab-テスト運用が重くなるのか\"\u003eなぜ A/B テスト運用が重くなるのか\u003c/h2\u003e\n\u003ch3 id=\"理由-1-リリース作業のコスト\"\u003e理由 1. リリース作業のコスト\u003c/h3\u003e\n\u003cp\u003eA/B テストの運用が重くなる理由の1として、A/B テストを始めるときのオペレーション、つまり新しいモデル／アルゴリズムをリリースする際の作業コストが重いことが挙げられる。\u003c/p\u003e\n\u003cp\u003eこれにはモデル／アルゴリズムが web のシステムに対してどのような形でデプロイされているかが影響する。\u003cbr\u003e\nmercari が次のような資料を公開しているので参考にしたい。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://engineering.mercari.com/blog/entry/ml-system-design/\"\u003e機械学習システムの設計パターンを公開します。\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e例えば \u003ca href=\"https://mercari.github.io/ml-system-design-pattern/Serving-patterns/Synchronous-pattern/design_ja.html\"\u003eSynchronous pattern\u003c/a\u003e のように web サーバと推論をする場所が分離している場合に比べて \u003ca href=\"https://mercari.github.io/ml-system-design-pattern/Serving-patterns/Web-single-pattern/design_ja.html\"\u003eWeb single pattern\u003c/a\u003e のように一体化している場合は新しいモデル／アルゴリズムのリリースに繊細にならざるを得ないのではないだろうか。\u003cbr\u003e\nコードベースもそうだし、マシンリソースの管理も後者の方が難しい。\u003cbr\u003e\n特にリリース担当者がデータサイエンティスト的な人だった場合、リリースの心理的障壁が上がる。\u003c/p\u003e\n\u003ch3 id=\"理由-2-はっきりしない指標\"\u003e理由 2. はっきりしない指標\u003c/h3\u003e\n\u003cp\u003eA/B テストするときはテストの指標として何らかの KPI を置く。\u003cbr\u003e\nこの KPI が複数ある場合がある。\u003cbr\u003e\n例えば web 広告における CTR 予測モデルであれば CTR と impression 等。\u003cbr\u003e\n現実のビジネスは複雑なので複数の KPI があるのは珍しくないと思われる。\u003c/p\u003e\n\u003cp\u003e一方で KPI が複数になると評価が難しくなる。\u003cbr\u003e\n「KPI A は5上がったけど B は3下がった、この場合はどうなの？」ということになり \u0026quot;マネージャの肌感\u0026quot; みたいなものが必要になってしまう。\u003cbr\u003e\n当然機械的に判定することによる自動化なども行えない。\u003cbr\u003e\nA/B テストの経過における現状の良し悪しの判断にコストがかかってしまうことになる。\u003cbr\u003e\nまた判断基準が複雑なことにより\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%81%8A%E3%81%A8%E3%82%8A%E5%8A%B9%E6%9E%9C\"\u003eお取り効果\u003c/a\u003eのようなことも発生しうるだろう。\u003c/p\u003e\n\u003cp\u003eこれについての1つの解として OEC: Overall Evaluation Criterion という考え方がある。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.analytics-toolkit.com/glossary/overall-evaluation-criterion/\"\u003eWhat does \u0026quot;Overall Evaluation Criterion\u0026quot; mean?\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e複数の KPI を重みをつけて組み合わせてただ1つの値として評価できるようにする、というものらしい。\u003cbr\u003e\n逆に考えると OEC を定義せずに複数の KPI で A/B テストをするということは KPI 間のバランスの合意なしで走ってしまっているということになる。\u003c/p\u003e\n\u003ch3 id=\"理由-3-煩雑な流量オペレーション\"\u003e理由 3. 煩雑な流量オペレーション\u003c/h3\u003e\n\u003cp\u003eこれは実際に見たことだが、A/B テストの運用に際して組織の一部の人間しか理解していない煩雑なオペレーションを伴うことがある。\u003c/p\u003e\n\u003cp\u003e最初は control group を 0.1% だけ流して、1日経って問題がなければ 1% に上げて、その次は5%で…などのような操作を求められるのである。\u003cbr\u003e\n担当者にすればまあまあのストレスだし、時間がかかってしまう。\u003c/p\u003e\n\u003ch2 id=\"まとめ\"\u003eまとめ\u003c/h2\u003e\n\u003cp\u003eつらいね。\u003c/p\u003e"
}
</script>

<link rel="preload" as="script" href="/bundle.js?v=1604718041">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://stats.g.doubleclick.net">
<link rel="preconnect" href="https://www.googleadservices.com">
<link rel="preload" as="script" href="https://www.googletagmanager.com/gtag/js?id=UA-73329599-2">
<script src="https://www.googletagmanager.com/gtag/js?id=UA-73329599-2"></script>
<script>
  window.dataLayer=window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js',new Date());
  gtag('config','UA-73329599-2');
</script>

</head>
<body>

  <header id="nav" class="header">
  <div class="ax-l-i max-w-6xl">
    <div class="ax-logo">
      <a class="block" href="/" title="Froglog"><span class="font-semibold text-raven-900">Froglog</span></a>
    </div>
    <div class="ax-user">
      <a class="p-2 w-8 h-8 block text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" target="_blank" rel="noopener nofollow" href="https://www.google.com/search?q=site:soonraah.github.io" title="Search">
        <svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.67 12.804c0-5.6 4.544-10.134 10.133-10.134s10.134 4.544 10.134 10.134-4.544 10.133-10.134 10.133S2.67 18.393 2.67 12.804zm28.943 16.923l-8.868-8.868c4.287-5.3 3.68-13.012-1.378-17.57S8.564-1.066 3.75 3.75s-5.017 12.558-.46 17.618 12.28 5.665 17.57 1.378l8.868 8.868a1.33 1.33 0 0 0 2.231-.597c.123-.46-.008-.952-.345-1.29h0z"/></svg>

      </a>
      <a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href="/posts/">
        Posts
      </a>
      <a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href="/tags/">
        Tags
      </a>
      <a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href="/about/">
        About
      </a>
    </div>
  </div>

  
</header>

  <main>
<div class="default-single">
  <div class="ax-title ax-l-o">
    <div class="ax-l-i max-w-680">
      <h1 class="post-title font-content-title font-normal leading-tight tracking-default text-40">A/B テストの運用が重くてつらいという話</h1>

      <div class="ax-meta flex items-center mt-5">
        <div class="flex-grow min-w-0">
          <div class="flex items-center">
  <div class="flex-shrink-0">
    <img
    class="w-12 h-12 sm:w-14 sm:h-14 object-cover p-3px rounded-full border border-blue-300"
    src="/image/author/soonraah.png"
    alt="soonraah">
  </div>
  <div class="flex-shrink-0 ml-2 leading-tight font-content-sans">
    <a class="block text-sm text-raven-800 hover:text-raven-900 hover:underline focus:underline" target="_blank" rel="noopener nofollow" title="soonraah" href="https://soonraah.github.io/">soonraah</a>
    <time class="text-sm text-raven-500" datetime="2020-08-23T03:30:00Z">2020-08-23 12:30</time>
  </div>
</div>

        </div>
        <div>
          <div class="flex items-center">
  <a class="flex-shrink-0 block text-raven-800 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Share on Twitter" href="https://twitter.com/intent/tweet?text=A%2fB%20%e3%83%86%e3%82%b9%e3%83%88%e3%81%ae%e9%81%8b%e7%94%a8%e3%81%8c%e9%87%8d%e3%81%8f%e3%81%a6%e3%81%a4%e3%82%89%e3%81%84%e3%81%a8%e3%81%84%e3%81%86%e8%a9%b1%20by%20%40soonraah%20https%3a%2f%2fsoonraah.github.io%2fheavy-ab-testing-operation%2f"><svg class="w-6 h-6 fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11 0 0 1-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56 0 0 0-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57 0 0 0 2.914 5.452 6.48 6.48 0 0 1-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42 0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57a13.18 13.18 0 0 1-8.134 2.798c-.538 0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072 0 18.672-10 18.672-18.668 0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg>
</a>
  <a class="ml-3 flex-shrink-0 block text-raven-800 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Share on Facebook" href="https://www.facebook.com/dialog/share?app_id=&display=page&href=https%3a%2f%2fsoonraah.github.io%2fheavy-ab-testing-operation%2f"><svg class="w-6 h-6 fill-current" viewBox="-7 -3.5 39 39" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M30.234 0H1.765C.8.001 0 .79 0 1.766v28.47C.001 31.2.79 32 1.766 32h15.328V19.625h-4.156V14.78h4.156v-3.564c0-4.134 2.523-6.384 6.21-6.384 1.766 0 3.284.13 3.726.2v4.32h-2.543c-2.006 0-2.394.953-2.394 2.352v3.085h4.797l-.625 4.844h-4.172V32h8.14C31.21 32 32 31.2 32 30.234V1.765C32 .8 31.21 0 30.234 0z"/></svg>
</a>
</div>

        </div>
      </div>
    </div>
  </div><div class="ax-content ax-l-o">
    <div class="ax-l-i max-w-680">
      <article class="cdata">


<figure class="center">
<img
class="mb-2 mx-auto leading-none shadow-xl"
src="/image/photo/jason-dent-JVD3XPqjLaQ-unsplash.jpg"
alt="Photo by Jason Dent on">
<figcaption class="text-sm text-right text-raven-500">
<p>Photo by Jason Dent on <a href="https://unsplash.com/photos/JVD3XPqjLaQ">Unsplash</a></p>
</figcaption>
</figure>

<h2 id="前提">前提</h2>
<p>ここでは web システムで使われている機械学習のモデルやアルゴリズムを改善するための online の A/B テストを考える。<br>
具体的に述べると web 広告における CTR 予測や EC サイトのレコメンデーション等が対象である。<br>
よくあるやつ。</p>
<p>web システムにおいて online の A/B テストは KPI 改善の根幹でありとても重要だ。<br>
それが重くなるとつらい、という話。<br>
ここで「重い」と言っているのは計算資源のことではなく、A/B テストを実施する担当者の運用コストについて。</p>
<h2 id="ab-テストの運用が重い場合のデメリット">A/B テストの運用が重い場合のデメリット</h2>
<h3 id="デメリット-1-kpi-改善が遅くなる">デメリット 1. KPI 改善が遅くなる</h3>
<p>デメリットと言えばこれが一番大きい。<br>
単純に A/B テストを1回まわすのに時間がかかってしまうし、それがゆえに online の A/B テストに入るまでの offline のテストが厚くなりここでも時間がかかってしまう。<br>
KPI 改善に時間がかかるというのはつまり売上や利益を大きくするのに時間がかかってしまうということである。</p>
<h3 id="デメリット-2-kpi-改善における-offline-テストの比重が大きくなる">デメリット 2. KPI 改善における offline テストの比重が大きくなる</h3>
<p>前述のとおりだが online の A/B テストが重いとそこで失敗できなくなり、結果としてその前段の offline のテストを厚くするということになる。<br>
offline のテストが厚いことの何が問題だろうか。</p>
<p>ここで前提としている CTR 予測やレコメンデーションのようなタスクの場合、offline のデータは既存のモデルやアルゴリズムの影響を受けることになる。<br>
例えばレコメンデーションの場合を考えると、新しいモデルを offline で評価するための実験データの正例 (コンテンツの閲覧等) は既存モデルによって生み出される。<br>
既存モデルが「このコンテンツがいいよ」といってユーザに出したリスト、その中からコンテンツの閲覧が行われ正例となるからだ。<br>
このような状況下での offline テストにおいては既存モデルと近い好みを持ったモデルのスコアが高くなる傾向がある。</p>
<p>もしかしたら既存モデルの影響を受けないようなデータをあえて用意しているような場合もあるかもしれないが、レアケースだろう。<br>
既存モデルの影響を受けないということは恩恵を受けないということなのでトレードオフでもある。</p>
<h3 id="デメリット-3-新モデルアルゴリズムを却下しにくくなる">デメリット 3. 新モデル／アルゴリズムを却下しにくくなる</h3>
<p>A/B テストの運用が重いと何度も繰り返すことができない。<br>
なので一発の A/B テストで既存モデル／アルゴリズムを置き換える成果を出さなければならないという圧が強くかかってしまう。<br>
既存モデル／アルゴリズムが勝って新しいものが負けてしまったときの埋没費用が大きいからだ。</p>
<p>そうなると次のような事が起こる。</p>
<ul>
<li>「新モデルをチューニングしてみよう！」
<ul>
<li>数ヶ月前のデータでチューニングされていない既存モデル vs. 直近のデータでチューニングされた新モデル</li>
</ul>
</li>
<li>「新モデルが KPI で勝っている間に意思決定しよう！」
<ul>
<li>勝ったり負けたりする中で…</li>
</ul>
</li>
</ul>
<p>つまりフェアなテストではなくなってしまう。</p>
<h2 id="なぜ-ab-テスト運用が重くなるのか">なぜ A/B テスト運用が重くなるのか</h2>
<h3 id="理由-1-リリース作業のコスト">理由 1. リリース作業のコスト</h3>
<p>A/B テストの運用が重くなる理由の1として、A/B テストを始めるときのオペレーション、つまり新しいモデル／アルゴリズムをリリースする際の作業コストが重いことが挙げられる。</p>
<p>これにはモデル／アルゴリズムが web のシステムに対してどのような形でデプロイされているかが影響する。<br>
mercari が次のような資料を公開しているので参考にしたい。</p>
<ul>
<li><a href="https://engineering.mercari.com/blog/entry/ml-system-design/">機械学習システムの設計パターンを公開します。</a></li>
</ul>
<p>例えば <a href="https://mercari.github.io/ml-system-design-pattern/Serving-patterns/Synchronous-pattern/design_ja.html">Synchronous pattern</a> のように web サーバと推論をする場所が分離している場合に比べて <a href="https://mercari.github.io/ml-system-design-pattern/Serving-patterns/Web-single-pattern/design_ja.html">Web single pattern</a> のように一体化している場合は新しいモデル／アルゴリズムのリリースに繊細にならざるを得ないのではないだろうか。<br>
コードベースもそうだし、マシンリソースの管理も後者の方が難しい。<br>
特にリリース担当者がデータサイエンティスト的な人だった場合、リリースの心理的障壁が上がる。</p>
<h3 id="理由-2-はっきりしない指標">理由 2. はっきりしない指標</h3>
<p>A/B テストするときはテストの指標として何らかの KPI を置く。<br>
この KPI が複数ある場合がある。<br>
例えば web 広告における CTR 予測モデルであれば CTR と impression 等。<br>
現実のビジネスは複雑なので複数の KPI があるのは珍しくないと思われる。</p>
<p>一方で KPI が複数になると評価が難しくなる。<br>
「KPI A は5上がったけど B は3下がった、この場合はどうなの？」ということになり &quot;マネージャの肌感&quot; みたいなものが必要になってしまう。<br>
当然機械的に判定することによる自動化なども行えない。<br>
A/B テストの経過における現状の良し悪しの判断にコストがかかってしまうことになる。<br>
また判断基準が複雑なことにより<a href="https://ja.wikipedia.org/wiki/%E3%81%8A%E3%81%A8%E3%82%8A%E5%8A%B9%E6%9E%9C">お取り効果</a>のようなことも発生しうるだろう。</p>
<p>これについての1つの解として OEC: Overall Evaluation Criterion という考え方がある。</p>
<ul>
<li><a href="https://www.analytics-toolkit.com/glossary/overall-evaluation-criterion/">What does &quot;Overall Evaluation Criterion&quot; mean?</a></li>
</ul>
<p>複数の KPI を重みをつけて組み合わせてただ1つの値として評価できるようにする、というものらしい。<br>
逆に考えると OEC を定義せずに複数の KPI で A/B テストをするということは KPI 間のバランスの合意なしで走ってしまっているということになる。</p>
<h3 id="理由-3-煩雑な流量オペレーション">理由 3. 煩雑な流量オペレーション</h3>
<p>これは実際に見たことだが、A/B テストの運用に際して組織の一部の人間しか理解していない煩雑なオペレーションを伴うことがある。</p>
<p>最初は control group を 0.1% だけ流して、1日経って問題がなければ 1% に上げて、その次は5%で…などのような操作を求められるのである。<br>
担当者にすればまあまあのストレスだし、時間がかかってしまう。</p>
<h2 id="まとめ">まとめ</h2>
<p>つらいね。</p>

      </article>
      

      

    </div>
  </div>
</div>

  </main>
  <footer class="footer">
  <div class="ax-l-i max-w-6xl">
    <nav class="flex items-center justify-center">
      <a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href="/posts/">Posts</a>
      <a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href="/tags/">Tags</a>
      <a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href="/about/">About</a>
    </nav>
    <div class="footer-social flex items-center justify-center mt-4">
      <a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Twitter" href="https://twitter.com/soonraah"><svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11 0 0 1-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56 0 0 0-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57 0 0 0 2.914 5.452 6.48 6.48 0 0 1-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42 0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57a13.18 13.18 0 0 1-8.134 2.798c-.538 0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072 0 18.672-10 18.672-18.668 0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg></a>
      <a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Github" href="https://github.com/soonraah"><svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M15.998 0C7.164 0 0 7.35 0 16.417 0 23.67 4.584 29.82 10.944 31.994c.8.15 1.092-.356 1.092-.79l-.022-2.792c-4.45.99-5.4-2.202-5.4-2.202-.726-1.896-1.776-2.4-1.776-2.4-1.454-1.018.108-.998.108-.998 1.606.117 2.45 1.693 2.45 1.693 1.428 2.507 3.746 1.784 4.658 1.363.144-1.06.558-1.784 1.016-2.195-3.552-.415-7.288-1.823-7.288-8.113 0-1.792.624-3.258 1.648-4.406-.166-.415-.714-2.085.156-4.344 0 0 1.344-.44 4.4 1.683 1.276-.364 2.644-.546 4.006-.552a14.98 14.98 0 0 1 4.006.554C23.062 6.37 24.404 6.8 24.404 6.8c.872 2.26.324 3.93.16 4.344 1.026 1.148 1.644 2.614 1.644 4.406 0 6.306-3.74 7.694-7.304 8.1.574.507 1.086 1.51 1.086 3.04l-.02 4.503c0 .44.288.95 1.1.788C27.42 29.817 32 23.667 32 16.417 32 7.35 24.836 0 15.998 0z"/></svg></a>
    </div>

    <div class="footer-copyright text-sm text-center text-gray-500 mt-4">
      &#169; 2020-2020 Froglog
    </div>
    <div class="text-sm sm:text-xs text-center text-gray-500 mt-2">
      Powered by <a href="https://www.axiomtheme.com/?utm_source=theme-footer&utm_medium=website&utm_campaign=referral">Axiom</a>
    </div>
  </div>
</footer>

<script src="/bundle.js?v=1604718041"></script>


</body>
</html>
