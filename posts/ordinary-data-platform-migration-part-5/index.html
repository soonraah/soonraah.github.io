<!doctype html><html lang=ja dir=auto><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-NSEGH2YT17"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NSEGH2YT17")</script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編 | Froglog</title>
<meta name=keywords content="data platform,ふつうのデータ基盤移行,IaC,Terraform,CI/CD,GitHub Actions,Databricks"><meta name=description content="このポストについて
データ基盤移行について書いていくシリーズです。
シリーズ一覧はこちらから。
前回 Part 4. AI ワークフローで移行作業効率化編では移行するための苦労と効率化について書きました。
今回はがらっと変わって IaC と CI/CD について書きます。
スコープ
今回は開発寄りの話です。
データ基盤の構築にあたり Terraform を使って IaC (Infrastructure as Code) を実現し、さらにそれに基づいて GitHub Actions による CI/CD (Continuous Integration & Continuous Derivery) 環境を作ったという話をしていきます。
IaC で作りたいアーキテクチャは AWS 上の Databricks 環境とその周辺です。
アーキテクチャについて詳しくは Part 3. アーキテクチャ編などをご参照ください。
だいたい以下の図のような話です。

お気持ち表明
こんにちは、初手で絶対に CI/CD 環境を構築するマンです。
初手で絶対に CI/CD 環境を構築するマンは、初手で絶対に CI/CD 環境を構築するぞ！という強い気持ちを持っています。
Databricks 上にデータ基盤を構築するにあたり、他社事例でインフラ構築を自動化していないケースを見たこともあります。
しかし我々のチームでは PoC 終了後の構築最初期から IaC としてインフラをコード化し、それを CI/CD の仕組みで自動でデプロイすることを決めていました。
次のような理由からです。

リリースの数だけ自動化のリターンがあるので、最初から自動化しておくのが最もリターンが大きい
チームにはジュニアなメンバーもおり、手動の運用はオペミスや production, staging などの環境差発生のリスクが大きい
社内で Terraform や GitHub Actions などがよく使われており、導入できる下地があった

まだ Databricks にそこまで慣れていない導入初期にこれらの仕組みを入れるのはそれなりにたいへんです。
しかしそのたいへんさ以上のメリットがあると判断しました。"><meta name=author content="soonraah"><link rel=canonical href=https://soonraah.github.io/posts/ordinary-data-platform-migration-part-5/><meta name=google-site-verification content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.2211ca3164be7830024f6aad2b3a2e520843a64f8f048445c3401c1249aa051d.css integrity="sha256-IhHKMWS+eDACT2qtKzouUghDpk+PBIRFw0AcEkmqBR0=" rel="preload stylesheet" as=style><link rel=icon href=https://soonraah.github.io/favicon2.ico><link rel=icon type=image/png sizes=16x16 href=https://soonraah.github.io/image/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://soonraah.github.io/image/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://soonraah.github.io/static/image/favicon/apple-touch-icon.png><link rel=mask-icon href=https://soonraah.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ja href=https://soonraah.github.io/posts/ordinary-data-platform-migration-part-5/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://soonraah.github.io/posts/ordinary-data-platform-migration-part-5/"><meta property="og:site_name" content="Froglog"><meta property="og:title" content="ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編"><meta property="og:description" content="このポストについて データ基盤移行について書いていくシリーズです。
シリーズ一覧はこちらから。
前回 Part 4. AI ワークフローで移行作業効率化編では移行するための苦労と効率化について書きました。
今回はがらっと変わって IaC と CI/CD について書きます。
スコープ 今回は開発寄りの話です。
データ基盤の構築にあたり Terraform を使って IaC (Infrastructure as Code) を実現し、さらにそれに基づいて GitHub Actions による CI/CD (Continuous Integration & Continuous Derivery) 環境を作ったという話をしていきます。
IaC で作りたいアーキテクチャは AWS 上の Databricks 環境とその周辺です。
アーキテクチャについて詳しくは Part 3. アーキテクチャ編などをご参照ください。
だいたい以下の図のような話です。
お気持ち表明 こんにちは、初手で絶対に CI/CD 環境を構築するマンです。
初手で絶対に CI/CD 環境を構築するマンは、初手で絶対に CI/CD 環境を構築するぞ！という強い気持ちを持っています。
Databricks 上にデータ基盤を構築するにあたり、他社事例でインフラ構築を自動化していないケースを見たこともあります。
しかし我々のチームでは PoC 終了後の構築最初期から IaC としてインフラをコード化し、それを CI/CD の仕組みで自動でデプロイすることを決めていました。
次のような理由からです。
リリースの数だけ自動化のリターンがあるので、最初から自動化しておくのが最もリターンが大きい チームにはジュニアなメンバーもおり、手動の運用はオペミスや production, staging などの環境差発生のリスクが大きい 社内で Terraform や GitHub Actions などがよく使われており、導入できる下地があった まだ Databricks にそこまで慣れていない導入初期にこれらの仕組みを入れるのはそれなりにたいへんです。
しかしそのたいへんさ以上のメリットがあると判断しました。"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-09-18T07:30:00+09:00"><meta property="article:modified_time" content="2025-09-18T07:30:00+09:00"><meta property="article:tag" content="Data Platform"><meta property="article:tag" content="ふつうのデータ基盤移行"><meta property="article:tag" content="IaC"><meta property="article:tag" content="Terraform"><meta property="article:tag" content="CI/CD"><meta property="article:tag" content="GitHub Actions"><meta property="og:image" content="https://soonraah.github.io/image/ordinary-data-plagform-migration/infra-and-delivery.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://soonraah.github.io/image/ordinary-data-plagform-migration/infra-and-delivery.jpg"><meta name=twitter:title content="ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編"><meta name=twitter:description content="このポストについて
データ基盤移行について書いていくシリーズです。
シリーズ一覧はこちらから。
前回 Part 4. AI ワークフローで移行作業効率化編では移行するための苦労と効率化について書きました。
今回はがらっと変わって IaC と CI/CD について書きます。
スコープ
今回は開発寄りの話です。
データ基盤の構築にあたり Terraform を使って IaC (Infrastructure as Code) を実現し、さらにそれに基づいて GitHub Actions による CI/CD (Continuous Integration & Continuous Derivery) 環境を作ったという話をしていきます。
IaC で作りたいアーキテクチャは AWS 上の Databricks 環境とその周辺です。
アーキテクチャについて詳しくは Part 3. アーキテクチャ編などをご参照ください。
だいたい以下の図のような話です。

お気持ち表明
こんにちは、初手で絶対に CI/CD 環境を構築するマンです。
初手で絶対に CI/CD 環境を構築するマンは、初手で絶対に CI/CD 環境を構築するぞ！という強い気持ちを持っています。
Databricks 上にデータ基盤を構築するにあたり、他社事例でインフラ構築を自動化していないケースを見たこともあります。
しかし我々のチームでは PoC 終了後の構築最初期から IaC としてインフラをコード化し、それを CI/CD の仕組みで自動でデプロイすることを決めていました。
次のような理由からです。

リリースの数だけ自動化のリターンがあるので、最初から自動化しておくのが最もリターンが大きい
チームにはジュニアなメンバーもおり、手動の運用はオペミスや production, staging などの環境差発生のリスクが大きい
社内で Terraform や GitHub Actions などがよく使われており、導入できる下地があった

まだ Databricks にそこまで慣れていない導入初期にこれらの仕組みを入れるのはそれなりにたいへんです。
しかしそのたいへんさ以上のメリットがあると判断しました。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://soonraah.github.io/posts/"},{"@type":"ListItem","position":2,"name":"ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編","item":"https://soonraah.github.io/posts/ordinary-data-platform-migration-part-5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編","name":"ふつうのデータ基盤移行 - Part 5. IaC と CI\/CD 編","description":"このポストについて データ基盤移行について書いていくシリーズです。\nシリーズ一覧はこちらから。\n前回 Part 4. AI ワークフローで移行作業効率化編では移行するための苦労と効率化について書きました。\n今回はがらっと変わって IaC と CI/CD について書きます。\nスコープ 今回は開発寄りの話です。\nデータ基盤の構築にあたり Terraform を使って IaC (Infrastructure as Code) を実現し、さらにそれに基づいて GitHub Actions による CI/CD (Continuous Integration \u0026amp; Continuous Derivery) 環境を作ったという話をしていきます。\nIaC で作りたいアーキテクチャは AWS 上の Databricks 環境とその周辺です。\nアーキテクチャについて詳しくは Part 3. アーキテクチャ編などをご参照ください。\nだいたい以下の図のような話です。\nお気持ち表明 こんにちは、初手で絶対に CI/CD 環境を構築するマンです。\n初手で絶対に CI/CD 環境を構築するマンは、初手で絶対に CI/CD 環境を構築するぞ！という強い気持ちを持っています。\nDatabricks 上にデータ基盤を構築するにあたり、他社事例でインフラ構築を自動化していないケースを見たこともあります。\nしかし我々のチームでは PoC 終了後の構築最初期から IaC としてインフラをコード化し、それを CI/CD の仕組みで自動でデプロイすることを決めていました。\n次のような理由からです。\nリリースの数だけ自動化のリターンがあるので、最初から自動化しておくのが最もリターンが大きい チームにはジュニアなメンバーもおり、手動の運用はオペミスや production, staging などの環境差発生のリスクが大きい 社内で Terraform や GitHub Actions などがよく使われており、導入できる下地があった まだ Databricks にそこまで慣れていない導入初期にこれらの仕組みを入れるのはそれなりにたいへんです。\nしかしそのたいへんさ以上のメリットがあると判断しました。\n","keywords":["data platform","ふつうのデータ基盤移行","IaC","Terraform","CI/CD","GitHub Actions","Databricks"],"articleBody":"このポストについて データ基盤移行について書いていくシリーズです。\nシリーズ一覧はこちらから。\n前回 Part 4. AI ワークフローで移行作業効率化編では移行するための苦労と効率化について書きました。\n今回はがらっと変わって IaC と CI/CD について書きます。\nスコープ 今回は開発寄りの話です。\nデータ基盤の構築にあたり Terraform を使って IaC (Infrastructure as Code) を実現し、さらにそれに基づいて GitHub Actions による CI/CD (Continuous Integration \u0026 Continuous Derivery) 環境を作ったという話をしていきます。\nIaC で作りたいアーキテクチャは AWS 上の Databricks 環境とその周辺です。\nアーキテクチャについて詳しくは Part 3. アーキテクチャ編などをご参照ください。\nだいたい以下の図のような話です。\nお気持ち表明 こんにちは、初手で絶対に CI/CD 環境を構築するマンです。\n初手で絶対に CI/CD 環境を構築するマンは、初手で絶対に CI/CD 環境を構築するぞ！という強い気持ちを持っています。\nDatabricks 上にデータ基盤を構築するにあたり、他社事例でインフラ構築を自動化していないケースを見たこともあります。\nしかし我々のチームでは PoC 終了後の構築最初期から IaC としてインフラをコード化し、それを CI/CD の仕組みで自動でデプロイすることを決めていました。\n次のような理由からです。\nリリースの数だけ自動化のリターンがあるので、最初から自動化しておくのが最もリターンが大きい チームにはジュニアなメンバーもおり、手動の運用はオペミスや production, staging などの環境差発生のリスクが大きい 社内で Terraform や GitHub Actions などがよく使われており、導入できる下地があった まだ Databricks にそこまで慣れていない導入初期にこれらの仕組みを入れるのはそれなりにたいへんです。\nしかしそのたいへんさ以上のメリットがあると判断しました。\nデータ基盤というプロダクトにおいて CI/CD は IaC とセットであると言えます。\nAWS や Databricks のレイヤーをコード化してコマンドでデプロイできるようにすることにより、CI/CD の運用が可能となります。\nIaC Terraform IaC の仕組みとしては Terraform を使います。\nDatabricks 独自の Asset Bundles という選択肢もありましたが、次のような理由から Terraform を使うことにしました。\n(前述のとおり) 社内に Terraform の知見があり、詳しいエンジニアもいて頼ることができる Databricks の環境は AWS 上に構築されており、データの取込やエクスポートまわりも含めて何かと AWS のリソース作成も必要となる チームとして Databricks のリソースだけ管理するわけではない Terraform には Databricks Provider があり、Databricks の様々なリソースを作ることができます。\n例えば我々の Terraform project では次のような Databricks のリソースを管理しています。\n各種 database object metastore catalog schema 権限まわり user, service principal, group 各種リソースへの権限の割当 データパイプライン関連 Lakeflow jobs (Databricks 独自の Airflow-like な workflow orchestration) SQL warehouse その他 各種設定 必要かつ Terraform で管理できるものは何でも Project 構成 Terraform project の構築は基本的に公式の style guide に基づくようにしました。\n例えばディレクトリ構成も以下の style guide の推奨構成をベースにしています。\n├── modules │ ├── compute │ │ └── main.tf │ ├── database │ │ └── main.tf │ └── network │ └── main.tf ├── dev │ ├── backend.tf │ ├── main.tf │ └── variables.tf ├── prod │ ├── backend.tf │ ├── main.tf │ └── variables.tf └── staging ├── backend.tf ├── main.tf └── variables.tf dev/, prod/ など各環境のディレクトリがあり、通常 terraform plan や terraform apply などのコマンドはこの各環境のディレクトリから実行されます。\nほぼすべてのリソースは Terraform module として moudules/ 以下で定義され、各種環境からはそれを呼び出して利用しています。\nmodule をどういった単位でまとめるかというところが難しいところで、実際に悩むこともよくあります。\nベースとなる考え方としては公式の Module creation - recommended pattern: Scope the requirements into appropriate modules | Terraform | HashiCorp Developer があります。\n簡単に言うと一緒にデプロイされるもの・権限を持つグループが同じもの・リソース寿命が同じものを同じ module にします。\nAWS が CloudFormation の best practice でよく似たことを言っていたりもします。\nよくやりがちなこととして同じタイプのリソースを同じ module に集めるというのがありますが、多くの場合ではそれは逆に bad practice だと考えています。\n再利用性を考えてうまく module を設計すると運用が楽になります。\n例えば外部システムから Databricks のデータにアクセスする設定のための module を構築し、外部システム名を入れるだけで次のようなことができるようにしました。\nservice principal (システムからアクセスするための user のような概念) の作成 service principal の認証のための secret 情報の作成 secret 情報の AWS Systems Manager Parameter Store への登録 service principal 用の SQL warehouse の作成 SQL warehouse の権限設定 あとはその外部システム固有の権限設定を行えば、外部システム管理者に Parameter Store の情報を教えるだけで利用できるという寸法です。\nこのように Databricks と AWS のリソースを1つの module に含めることができるのも Terraform の利点です。\nDatabricks × Terraform の注意点 …というように Terraform project を構築して運用しているのですが、Databricks のリソースを Terraform で管理するにあたってはいくつか注意点があります。\nTerraform で扱えないリソース dbt によるリソース管理 古い名前のリソース リソース間の依存関係 Terraform で扱えないリソース すべての Databricks リソースが Terraform で扱えるわけではありません。\n例えば Unity Catalog におけるユーザー定義関数などがそれにあたります。\nこういったものは別の仕組みで管理する必要があります。\ndbt によるリソース管理 一方で table や view は Terraform で扱うことができますが、我々の Terraform project ではこれらは扱っていません。\nELT の仕組みとして dbt を導入しており、table や view は dbt で作られるためです。\nTerraform 以外で管理したいリソースもあるということです。\n古い名前のリソース Databricks ではときどきサービスや各種概念の名前が変わりますが、Terraform リソースの名前は古いままになっていることがあります。(おそらく互換性のため)\n例えば SQL warehouse を作るための Terrafrom リソースは SQL warehouse の古い名前である databricks_sql_endpoint となっています。\nなので Terraform のコードを読むときに気をつける必要があります。\nリソース間の依存関係 Databricks に限ったことではないですが、「A を作った後でないと B を作れない」といったような依存関係がリソース間にある場合があります。\n多くの場合はリソース B の argument として A の attribute を指定することになり、Terraform により暗黙的によしなに依存関係に配慮がなされます。\nしかしまれに実質的には依存関係があるのに暗黙的な依存関係が作られないことがあります。\nそういった場合は depends_on で明示的に依存関係を示してやる必要があります。\nCI/CD GitHub Actions さて、IaC が Terraform project で構築できたわけですが、ここまでできていれば CI/CD に IaC を組み込むのは難しくありません。\nCI/CD のフレームワークとしては GitHub Actions を採用しました。\n組織として GitHub 上でコード管理をしており、GitHub Actions もよく使われていたからです。\nTerraform project への変更を含む pull request が merge されると、GitHub Actions がトリガーされて terraform apply が実行され、インフラの変更が production 環境へと反映されます。\n(ちなみに pull request のレビュー前に staging 環境での検証を義務付けているので、production 環境への反映で失敗することはまれにしかありません)\nつまりリリース作業に手動のオペレーションは極力含まれないようにしています。\nCI/CD でやること GitHub Actions の中では terraform apply 以外に次のようなことをやっています。\nTerraform 関連 terraform init, terraform validate によるチェック TFLint による linting Open Policy Agent によるリソースポリシーのチェック 例えば S3 bucket 名が命名ルールに従っているかなど、様々なチェックができる (楽しいけど Rego がむずい) dbt 関連 SQLFluff による linting dbt-osmosis による table や column の description のチェック dbt project の Databricks 環境へのデプロイ Python 関連 Flake8, Black による linting unit test Python project の Databricks 環境へのデプロイ このあたりはまだまだ充実させたいと考えています。\n例えば dbt で複雑な処理を実装した場合の unit test がまだありません。\ndbt の unit test の導入は現在検討中で、近いうちに GitHub Actions から実行できるようにしようとしています。\npre-commit CI/CD に含めるかは微妙ですが、GitHub Actions でやっているチェックのうちのいくつかはローカル開発環境の pre-commit により、git commit 時にもチェックしています。\n変更を git push してから GitHub Actions でチェック失敗に気づくよりは、ローカルで気付ける方がリードタイムが短く楽だからです。\nちなみに正規のチェックは GitHub Actions であり、pre-commit はあくまで補助的なものです。\npre-commit は開発者が設定していなかったり git commit --no-verify されたりしたら機能しないので、信頼性の面で GitHub Actions の方が上です。\n運用はどんどん楽に、かつメンバーのスキルに依存せず安定して行えるようにしていきたいです。\nちゃんとやっている組織の方からすると普通のことかもしれませんが、地道に改善していく所存です。\n次回予告 次はメタデータの話でもしようかな。\n","wordCount":"562","inLanguage":"ja","image":"https://soonraah.github.io/image/ordinary-data-plagform-migration/infra-and-delivery.jpg","datePublished":"2025-09-18T07:30:00+09:00","dateModified":"2025-09-18T07:30:00+09:00","author":{"@type":"Person","name":"soonraah"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://soonraah.github.io/posts/ordinary-data-platform-migration-part-5/"},"publisher":{"@type":"Organization","name":"Froglog","logo":{"@type":"ImageObject","url":"https://soonraah.github.io/favicon2.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://soonraah.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://soonraah.github.io/image/brand/favicon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://soonraah.github.io/about/ title=About><span>About</span></a></li><li><a href=https://soonraah.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://soonraah.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://soonraah.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://soonraah.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://soonraah.github.io/>ホーム</a>&nbsp;»&nbsp;<a href=https://soonraah.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編</h1><div class=post-meta><span title='2025-09-18 07:30:00 +0900 JST'>9月 18, 2025</span>&nbsp;·&nbsp;soonraah</div></header><figure class=entry-cover><img loading=eager src=https://soonraah.github.io/image/ordinary-data-plagform-migration/infra-and-delivery.jpg alt="infra and delivery"><figcaption>Image by OpenAI DALL·E</figcaption></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目次</span></summary><div class=inner><ul><li><a href=#%e3%81%93%e3%81%ae%e3%83%9d%e3%82%b9%e3%83%88%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6 aria-label=このポストについて>このポストについて</a></li><li><a href=#%e3%82%b9%e3%82%b3%e3%83%bc%e3%83%97 aria-label=スコープ>スコープ</a></li><li><a href=#%e3%81%8a%e6%b0%97%e6%8c%81%e3%81%a1%e8%a1%a8%e6%98%8e aria-label=お気持ち表明>お気持ち表明</a></li><li><a href=#iac aria-label=IaC>IaC</a><ul><li><a href=#terraform aria-label=Terraform>Terraform</a></li><li><a href=#project-%e6%a7%8b%e6%88%90 aria-label="Project 構成">Project 構成</a></li><li><a href=#databricks--terraform-%e3%81%ae%e6%b3%a8%e6%84%8f%e7%82%b9 aria-label="Databricks × Terraform の注意点">Databricks × Terraform の注意点</a><ul><li><a href=#terraform-%e3%81%a7%e6%89%b1%e3%81%88%e3%81%aa%e3%81%84%e3%83%aa%e3%82%bd%e3%83%bc%e3%82%b9 aria-label="Terraform で扱えないリソース">Terraform で扱えないリソース</a></li><li><a href=#dbt-%e3%81%ab%e3%82%88%e3%82%8b%e3%83%aa%e3%82%bd%e3%83%bc%e3%82%b9%e7%ae%a1%e7%90%86 aria-label="dbt によるリソース管理">dbt によるリソース管理</a></li><li><a href=#%e5%8f%a4%e3%81%84%e5%90%8d%e5%89%8d%e3%81%ae%e3%83%aa%e3%82%bd%e3%83%bc%e3%82%b9 aria-label=古い名前のリソース>古い名前のリソース</a></li><li><a href=#%e3%83%aa%e3%82%bd%e3%83%bc%e3%82%b9%e9%96%93%e3%81%ae%e4%be%9d%e5%ad%98%e9%96%a2%e4%bf%82 aria-label=リソース間の依存関係>リソース間の依存関係</a></li></ul></li></ul></li><li><a href=#cicd aria-label=CI/CD>CI/CD</a><ul><li><a href=#github-actions aria-label="GitHub Actions">GitHub Actions</a></li><li><a href=#cicd-%e3%81%a7%e3%82%84%e3%82%8b%e3%81%93%e3%81%a8 aria-label="CI/CD でやること">CI/CD でやること</a></li><li><a href=#pre-commit aria-label=pre-commit>pre-commit</a></li></ul></li><li><a href=#%e6%ac%a1%e5%9b%9e%e4%ba%88%e5%91%8a aria-label=次回予告>次回予告</a></li></ul></div></details></div><div class=post-content><h2 id=このポストについて>このポストについて<a hidden class=anchor aria-hidden=true href=#このポストについて>#</a></h2><p>データ基盤移行について書いていくシリーズです。<br>シリーズ一覧は<a href=/tags/%E3%81%B5%E3%81%A4%E3%81%86%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E5%9F%BA%E7%9B%A4%E7%A7%BB%E8%A1%8C/>こちら</a>から。</p><p>前回 <a href=/posts/ordinary-data-platform-migration-part-4/>Part 4. AI ワークフローで移行作業効率化編</a>では移行するための苦労と効率化について書きました。<br>今回はがらっと変わって IaC と CI/CD について書きます。</p><h2 id=スコープ>スコープ<a hidden class=anchor aria-hidden=true href=#スコープ>#</a></h2><p>今回は開発寄りの話です。<br>データ基盤の構築にあたり Terraform を使って IaC (Infrastructure as Code) を実現し、さらにそれに基づいて GitHub Actions による CI/CD (Continuous Integration & Continuous Derivery) 環境を作ったという話をしていきます。</p><p>IaC で作りたいアーキテクチャは AWS 上の Databricks 環境とその周辺です。<br>アーキテクチャについて詳しくは <a href=/posts/ordinary-data-platform-migration-part-3/>Part 3. アーキテクチャ編</a>などをご参照ください。</p><p>だいたい以下の図のような話です。</p><p><img alt=CI/CD loading=lazy src=/image/ordinary-data-plagform-migration/ci_cd.png></p><h2 id=お気持ち表明>お気持ち表明<a hidden class=anchor aria-hidden=true href=#お気持ち表明>#</a></h2><p>こんにちは、初手で絶対に CI/CD 環境を構築するマンです。<br>初手で絶対に CI/CD 環境を構築するマンは、初手で絶対に CI/CD 環境を構築するぞ！という強い気持ちを持っています。</p><p>Databricks 上にデータ基盤を構築するにあたり、他社事例でインフラ構築を自動化していないケースを見たこともあります。<br>しかし我々のチームでは PoC 終了後の構築最初期から IaC としてインフラをコード化し、それを CI/CD の仕組みで自動でデプロイすることを決めていました。<br>次のような理由からです。</p><ul><li>リリースの数だけ自動化のリターンがあるので、最初から自動化しておくのが最もリターンが大きい</li><li>チームにはジュニアなメンバーもおり、手動の運用はオペミスや production, staging などの環境差発生のリスクが大きい</li><li>社内で Terraform や GitHub Actions などがよく使われており、導入できる下地があった</li></ul><p>まだ Databricks にそこまで慣れていない導入初期にこれらの仕組みを入れるのはそれなりにたいへんです。<br>しかしそのたいへんさ以上のメリットがあると判断しました。</p><p>データ基盤というプロダクトにおいて CI/CD は IaC とセットであると言えます。<br>AWS や Databricks のレイヤーをコード化してコマンドでデプロイできるようにすることにより、CI/CD の運用が可能となります。</p><h2 id=iac>IaC<a hidden class=anchor aria-hidden=true href=#iac>#</a></h2><h3 id=terraform>Terraform<a hidden class=anchor aria-hidden=true href=#terraform>#</a></h3><p>IaC の仕組みとしては <a href=https://developer.hashicorp.com/terraform>Terraform</a> を使います。<br>Databricks 独自の <a href=https://docs.databricks.com/aws/en/dev-tools/bundles/>Asset Bundles</a> という選択肢もありましたが、次のような理由から Terraform を使うことにしました。</p><ul><li>(前述のとおり) 社内に Terraform の知見があり、詳しいエンジニアもいて頼ることができる</li><li>Databricks の環境は AWS 上に構築されており、データの取込やエクスポートまわりも含めて何かと AWS のリソース作成も必要となる<ul><li>チームとして Databricks のリソースだけ管理するわけではない</li></ul></li></ul><p>Terraform には <a href=https://registry.terraform.io/providers/databricks/databricks/latest/docs>Databricks Provider</a> があり、Databricks の様々なリソースを作ることができます。<br>例えば我々の Terraform project では次のような Databricks のリソースを管理しています。</p><ul><li>各種 database object<ul><li>metastore</li><li>catalog</li><li>schema</li></ul></li><li>権限まわり<ul><li>user, service principal, group</li><li>各種リソースへの権限の割当</li></ul></li><li>データパイプライン関連<ul><li>Lakeflow jobs (Databricks 独自の Airflow-like な workflow orchestration)</li><li>SQL warehouse</li></ul></li><li>その他<ul><li>各種設定</li><li>必要かつ Terraform で管理できるものは何でも</li></ul></li></ul><h3 id=project-構成>Project 構成<a hidden class=anchor aria-hidden=true href=#project-構成>#</a></h3><p>Terraform project の構築は基本的に公式の <a href=https://developer.hashicorp.com/terraform/language/style>style guide</a> に基づくようにしました。<br>例えばディレクトリ構成も以下の style guide の推奨構成をベースにしています。</p><pre tabindex=0><code>├── modules
│   ├── compute
│   │   └── main.tf
│   ├── database
│   │   └── main.tf
│   └── network
│       └── main.tf
├── dev
│   ├── backend.tf
│   ├── main.tf
│   └── variables.tf
├── prod
│   ├── backend.tf
│   ├── main.tf
│   └── variables.tf
└── staging
    ├── backend.tf
    ├── main.tf
    └── variables.tf
</code></pre><p>dev/, prod/ など各環境のディレクトリがあり、通常 <code>terraform plan</code> や <code>terraform apply</code> などのコマンドはこの各環境のディレクトリから実行されます。<br>ほぼすべてのリソースは Terraform module として moudules/ 以下で定義され、各種環境からはそれを呼び出して利用しています。</p><p>module をどういった単位でまとめるかというところが難しいところで、実際に悩むこともよくあります。<br>ベースとなる考え方としては公式の <a href=https://developer.hashicorp.com/terraform/tutorials/modules/pattern-module-creation#scope-the-requirements-into-appropriate-modules>Module creation - recommended pattern: Scope the requirements into appropriate modules | Terraform | HashiCorp Developer</a> があります。<br>簡単に言うと一緒にデプロイされるもの・権限を持つグループが同じもの・リソース寿命が同じものを同じ module にします。<br>AWS が CloudFormation の best practice で<a href=https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html#organizingstacks>よく似たこと</a>を言っていたりもします。<br>よくやりがちなこととして同じタイプのリソースを同じ module に集めるというのがありますが、多くの場合ではそれは逆に bad practice だと考えています。</p><p>再利用性を考えてうまく module を設計すると運用が楽になります。<br>例えば外部システムから Databricks のデータにアクセスする設定のための module を構築し、外部システム名を入れるだけで次のようなことができるようにしました。</p><ul><li>service principal (システムからアクセスするための user のような概念) の作成</li><li>service principal の認証のための secret 情報の作成</li><li>secret 情報の AWS Systems Manager Parameter Store への登録</li><li>service principal 用の SQL warehouse の作成</li><li>SQL warehouse の権限設定</li></ul><p>あとはその外部システム固有の権限設定を行えば、外部システム管理者に Parameter Store の情報を教えるだけで利用できるという寸法です。<br>このように Databricks と AWS のリソースを1つの module に含めることができるのも Terraform の利点です。</p><h3 id=databricks--terraform-の注意点>Databricks × Terraform の注意点<a hidden class=anchor aria-hidden=true href=#databricks--terraform-の注意点>#</a></h3><p>…というように Terraform project を構築して運用しているのですが、Databricks のリソースを Terraform で管理するにあたってはいくつか注意点があります。</p><ul><li>Terraform で扱えないリソース</li><li>dbt によるリソース管理</li><li>古い名前のリソース</li><li>リソース間の依存関係</li></ul><h4 id=terraform-で扱えないリソース>Terraform で扱えないリソース<a hidden class=anchor aria-hidden=true href=#terraform-で扱えないリソース>#</a></h4><p>すべての Databricks リソースが Terraform で扱えるわけではありません。<br>例えば Unity Catalog における<a href=https://docs.databricks.com/gcp/en/udf/unity-catalog>ユーザー定義関数</a>などがそれにあたります。<br>こういったものは別の仕組みで管理する必要があります。</p><h4 id=dbt-によるリソース管理>dbt によるリソース管理<a hidden class=anchor aria-hidden=true href=#dbt-によるリソース管理>#</a></h4><p>一方で table や view は Terraform で扱うことができますが、我々の Terraform project ではこれらは扱っていません。<br>ELT の仕組みとして dbt を導入しており、table や view は dbt で作られるためです。<br>Terraform 以外で管理したいリソースもあるということです。</p><h4 id=古い名前のリソース>古い名前のリソース<a hidden class=anchor aria-hidden=true href=#古い名前のリソース>#</a></h4><p>Databricks ではときどきサービスや各種概念の名前が変わりますが、Terraform リソースの名前は古いままになっていることがあります。(おそらく互換性のため)<br>例えば <a href=https://docs.databricks.com/aws/en/compute/sql-warehouse/>SQL warehouse</a> を作るための Terrafrom リソースは SQL warehouse の<a href=https://docs.databricks.com/aws/en/compute/sql-warehouse/#sql-warehouses-vs-sql-endpoints>古い名前</a>である <a href=https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/sql_endpoint><code>databricks_sql_endpoint</code></a> となっています。<br>なので Terraform のコードを読むときに気をつける必要があります。</p><h4 id=リソース間の依存関係>リソース間の依存関係<a hidden class=anchor aria-hidden=true href=#リソース間の依存関係>#</a></h4><p>Databricks に限ったことではないですが、「A を作った後でないと B を作れない」といったような依存関係がリソース間にある場合があります。<br>多くの場合はリソース B の argument として A の attribute を指定することになり、Terraform により暗黙的によしなに依存関係に配慮がなされます。<br>しかしまれに実質的には依存関係があるのに暗黙的な依存関係が作られないことがあります。<br>そういった場合は <a href=https://developer.hashicorp.com/terraform/language/meta-arguments#depends_on><code>depends_on</code></a> で明示的に依存関係を示してやる必要があります。</p><h2 id=cicd>CI/CD<a hidden class=anchor aria-hidden=true href=#cicd>#</a></h2><h3 id=github-actions>GitHub Actions<a hidden class=anchor aria-hidden=true href=#github-actions>#</a></h3><p>さて、IaC が Terraform project で構築できたわけですが、ここまでできていれば CI/CD に IaC を組み込むのは難しくありません。<br>CI/CD のフレームワークとしては GitHub Actions を採用しました。<br>組織として GitHub 上でコード管理をしており、GitHub Actions もよく使われていたからです。</p><p>Terraform project への変更を含む pull request が merge されると、GitHub Actions がトリガーされて <code>terraform apply</code> が実行され、インフラの変更が production 環境へと反映されます。<br>(ちなみに pull request のレビュー前に staging 環境での検証を義務付けているので、production 環境への反映で失敗することはまれにしかありません)<br>つまりリリース作業に手動のオペレーションは極力含まれないようにしています。</p><h3 id=cicd-でやること>CI/CD でやること<a hidden class=anchor aria-hidden=true href=#cicd-でやること>#</a></h3><p>GitHub Actions の中では <code>terraform apply</code> 以外に次のようなことをやっています。</p><ul><li>Terraform 関連<ul><li><code>terraform init</code>, <code>terraform validate</code> によるチェック</li><li><a href=https://github.com/terraform-linters/tflint>TFLint</a> による linting</li><li><a href=https://www.openpolicyagent.org/docs>Open Policy Agent</a> によるリソースポリシーのチェック<ul><li>例えば S3 bucket 名が命名ルールに従っているかなど、様々なチェックができる (楽しいけど Rego がむずい)</li></ul></li></ul></li><li>dbt 関連<ul><li><a href=https://docs.sqlfluff.com/en/stable/>SQLFluff</a> による linting</li><li>dbt-osmosis による table や column の description のチェック</li><li>dbt project の Databricks 環境へのデプロイ</li></ul></li><li>Python 関連<ul><li>Flake8, Black による linting</li><li>unit test</li><li>Python project の Databricks 環境へのデプロイ</li></ul></li></ul><p>このあたりはまだまだ充実させたいと考えています。<br>例えば dbt で複雑な処理を実装した場合の <a href=https://docs.getdbt.com/docs/build/unit-tests>unit test</a> がまだありません。<br>dbt の unit test の導入は現在検討中で、近いうちに GitHub Actions から実行できるようにしようとしています。</p><h3 id=pre-commit>pre-commit<a hidden class=anchor aria-hidden=true href=#pre-commit>#</a></h3><p>CI/CD に含めるかは微妙ですが、GitHub Actions でやっているチェックのうちのいくつかはローカル開発環境の <a href=https://pre-commit.com/>pre-commit</a> により、<code>git commit</code> 時にもチェックしています。<br>変更を <code>git push</code> してから GitHub Actions でチェック失敗に気づくよりは、ローカルで気付ける方がリードタイムが短く楽だからです。<br>ちなみに正規のチェックは GitHub Actions であり、pre-commit はあくまで補助的なものです。<br>pre-commit は開発者が設定していなかったり <code>git commit --no-verify</code> されたりしたら機能しないので、信頼性の面で GitHub Actions の方が上です。</p><p>運用はどんどん楽に、かつメンバーのスキルに依存せず安定して行えるようにしていきたいです。<br>ちゃんとやっている組織の方からすると普通のことかもしれませんが、地道に改善していく所存です。</p><h2 id=次回予告>次回予告<a hidden class=anchor aria-hidden=true href=#次回予告>#</a></h2><p>次はメタデータの話でもしようかな。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://soonraah.github.io/tags/data-platform/>Data Platform</a></li><li><a href=https://soonraah.github.io/tags/%E3%81%B5%E3%81%A4%E3%81%86%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E5%9F%BA%E7%9B%A4%E7%A7%BB%E8%A1%8C/>ふつうのデータ基盤移行</a></li><li><a href=https://soonraah.github.io/tags/iac/>IaC</a></li><li><a href=https://soonraah.github.io/tags/terraform/>Terraform</a></li><li><a href=https://soonraah.github.io/tags/ci/cd/>CI/CD</a></li><li><a href=https://soonraah.github.io/tags/github-actions/>GitHub Actions</a></li><li><a href=https://soonraah.github.io/tags/databricks/>Databricks</a></li></ul><nav class=paginav><a class=next href=https://soonraah.github.io/posts/cloud-finops-for-data-engineer/><span class=title>次へ »</span><br><span>データエンジニアから見るクラウド FinOps</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編 on x" href="https://x.com/intent/tweet/?text=%e3%81%b5%e3%81%a4%e3%81%86%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e5%9f%ba%e7%9b%a4%e7%a7%bb%e8%a1%8c%20-%20Part%205.%20IaC%20%e3%81%a8%20CI%2fCD%20%e7%b7%a8&amp;url=https%3a%2f%2fsoonraah.github.io%2fposts%2fordinary-data-platform-migration-part-5%2f&amp;hashtags=dataplatform%2c%e3%81%b5%e3%81%a4%e3%81%86%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e5%9f%ba%e7%9b%a4%e7%a7%bb%e8%a1%8c%2cIaC%2cTerraform%2cCI%2fCD%2cGitHubActions%2cDatabricks"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsoonraah.github.io%2fposts%2fordinary-data-platform-migration-part-5%2f&amp;title=%e3%81%b5%e3%81%a4%e3%81%86%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e5%9f%ba%e7%9b%a4%e7%a7%bb%e8%a1%8c%20-%20Part%205.%20IaC%20%e3%81%a8%20CI%2fCD%20%e7%b7%a8&amp;summary=%e3%81%b5%e3%81%a4%e3%81%86%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e5%9f%ba%e7%9b%a4%e7%a7%bb%e8%a1%8c%20-%20Part%205.%20IaC%20%e3%81%a8%20CI%2fCD%20%e7%b7%a8&amp;source=https%3a%2f%2fsoonraah.github.io%2fposts%2fordinary-data-platform-migration-part-5%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fsoonraah.github.io%2fposts%2fordinary-data-platform-migration-part-5%2f&title=%e3%81%b5%e3%81%a4%e3%81%86%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e5%9f%ba%e7%9b%a4%e7%a7%bb%e8%a1%8c%20-%20Part%205.%20IaC%20%e3%81%a8%20CI%2fCD%20%e7%b7%a8"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsoonraah.github.io%2fposts%2fordinary-data-platform-migration-part-5%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編 on whatsapp" href="https://api.whatsapp.com/send?text=%e3%81%b5%e3%81%a4%e3%81%86%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e5%9f%ba%e7%9b%a4%e7%a7%bb%e8%a1%8c%20-%20Part%205.%20IaC%20%e3%81%a8%20CI%2fCD%20%e7%b7%a8%20-%20https%3a%2f%2fsoonraah.github.io%2fposts%2fordinary-data-platform-migration-part-5%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編 on telegram" href="https://telegram.me/share/url?text=%e3%81%b5%e3%81%a4%e3%81%86%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e5%9f%ba%e7%9b%a4%e7%a7%bb%e8%a1%8c%20-%20Part%205.%20IaC%20%e3%81%a8%20CI%2fCD%20%e7%b7%a8&amp;url=https%3a%2f%2fsoonraah.github.io%2fposts%2fordinary-data-platform-migration-part-5%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ふつうのデータ基盤移行 - Part 5. IaC と CI/CD 編 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e3%81%b5%e3%81%a4%e3%81%86%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e5%9f%ba%e7%9b%a4%e7%a7%bb%e8%a1%8c%20-%20Part%205.%20IaC%20%e3%81%a8%20CI%2fCD%20%e7%b7%a8&u=https%3a%2f%2fsoonraah.github.io%2fposts%2fordinary-data-platform-migration-part-5%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://soonraah.github.io/>Froglog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="コピー";function s(){t.innerHTML="コピーされました!",setTimeout(()=>{t.innerHTML="コピー"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>